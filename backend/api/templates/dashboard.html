<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>See QR 스캐너 관리자 페이지 - 문의 게시판 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }

        .custom-shadow {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .table-row:hover {
            background-color: #fafafa;
        }

        .safety-tag {
            padding: 2px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            border: 1px solid #e5e7eb;
            background: rgba(255, 255, 255, 0.04);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .safety-tag-safe {
            color: #16a34a;
            border-color: rgba(74, 222, 128, 0.4);
            background: rgba(74, 222, 128, 0.08);
        }

        .safety-tag-warn {
            color: #d97706;
            border-color: rgba(251, 191, 36, 0.4);
            background: rgba(251, 191, 36, 0.08);
        }

        .safety-tag-risk {
            color: #dc2626;
            border-color: rgba(248, 113, 113, 0.4);
            background: rgba(248, 113, 113, 0.08);
        }

        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col">

    <!-- 메인 콘텐츠 영역 -->
    <main class="flex-1 overflow-y-auto p-8">
        <div class="max-w-7xl mx-auto">
            
            <!-- 제목 영역 -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-800 tracking-tight">문의 리스트 관리</h1>
                <p class="text-gray-500 mt-2">고객 문의 내역을 확인하고 처리 상태를 관리합니다.</p>
            </div>

            <!-- 필터 영역 -->
            <form class="bg-white p-5 rounded-2xl custom-shadow mb-8 flex flex-wrap items-center gap-4" method="get" action="/api/dashboard/">
                <div class="relative flex-1 min-w-[220px]">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input
                        type="text"
                        name="q"
                        value="{{ q|default:'' }}"
                        placeholder="URL로 검색하세요"
                        class="bg-gray-50 border border-gray-100 text-sm rounded-xl block w-full pl-11 pr-4 p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400/20 focus:border-yellow-400 transition-all text-gray-700 font-medium"
                    />
                </div>

                <div class="relative">
                    <select name="status" class="appearance-none bg-gray-50 border border-gray-100 text-sm rounded-xl block w-56 p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400/20 focus:border-yellow-400 transition-all cursor-pointer text-gray-700 font-medium">
                        <option value="all" {% if status == "all" %}selected{% endif %}>모든 처리 상태</option>
                        <option value="pending" {% if status == "pending" %}selected{% endif %}>대기 중</option>
                        <option value="accepted" {% if status == "accepted" %}selected{% endif %}>완료</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-400">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>

                <button class="bg-yellow-400 text-white font-bold text-sm px-5 py-3 rounded-xl shadow-md shadow-yellow-400/20 hover:bg-yellow-500 transition-all" type="submit">
                    검색
                </button>
            </form>

            <!-- 게시판 테이블 카드 (균형 잡힌 너비 설정) -->
            <div class="bg-white rounded-2xl custom-shadow overflow-hidden border border-gray-50">
                <table class="w-full text-left border-collapse table-fixed">
                    <thead>
                        <tr class="text-gray-400 text-xs font-bold border-b bg-gray-50/50 uppercase tracking-widest">
                            <th class="px-8 py-5 w-[120px]">No.</th>
                            <th class="px-6 py-5 w-[160px]">AI 분석 위험도</th>
                            <th class="px-6 py-5 w-[140px]">실제 위험도</th>
                            <th class="px-6 py-5">문의 내용</th>
                            <th class="px-6 py-5 w-[140px]">처리 상태</th>
                            <th class="px-8 py-5 text-right w-[160px]">등록일자</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm text-gray-700 divide-y divide-gray-50">
                        {% for inquiry in inquiries %}
                        <tr class="table-row transition-colors cursor-pointer" onclick="location.href='/api/inquire/{{ inquiry.id }}/edit/'">
                            <td class="px-8 py-6 font-mono text-gray-400 text-xs">{{ inquiry.id }}</td>
                            <td class="px-6 py-6">
                                {% if inquiry.ai_threat_label == '안전' %}
                                <span class="safety-tag safety-tag-safe">안전</span>
                                {% elif inquiry.ai_threat_label == '주의' %}
                                <span class="safety-tag safety-tag-warn">주의</span>
                                {% elif inquiry.ai_threat_label == '위험' %}
                                <span class="safety-tag safety-tag-risk">위험</span>
                                {% else %}
                                <span class="safety-tag">알 수 없음</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-6">
                                {% if inquiry.actual_threat == 'safe' %}
                                <span class="safety-tag safety-tag-safe">안전</span>
                                {% elif inquiry.actual_threat == 'warn' %}
                                <span class="safety-tag safety-tag-warn">주의</span>
                                {% else %}
                                <span class="safety-tag safety-tag-risk">위험</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-6 text-gray-600">
                                <div class="truncate font-medium text-gray-800">{{ inquiry.details|default:'(내용 없음)' }}</div>
                                <div class="text-xs text-gray-400 mt-1 truncate">{{ inquiry.url }}</div>
                            </td>
                            <td class="px-6 py-6">
                                {% if inquiry.is_accept %}
                                <span class="flex items-center gap-1.5 text-emerald-600 font-bold bg-emerald-50 px-3 py-1 rounded-full text-[11px] w-fit border border-emerald-100">
                                    <i class="fa-solid fa-check text-[9px]"></i>완료
                                </span>
                                {% else %}
                                <span class="flex items-center gap-1.5 text-gray-500 font-bold bg-gray-50 px-3 py-1 rounded-full text-[11px] w-fit border border-gray-200">
                                    <span class="w-1.5 h-1.5 bg-gray-400 rounded-full"></span>대기 중
                                </span>
                                {% endif %}
                            </td>
                            <td class="px-8 py-6 text-right text-gray-400 font-medium uppercase">{{ inquiry.created_at|date:"Y.m.d" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="px-8 py-10 text-center text-sm text-gray-400">조회된 문의가 없습니다.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- 하단 정보 및 페이지네이션 -->
            <div class="mt-10 flex items-center justify-between px-2">
                <p class="text-sm text-gray-400">표시 결과: 총 <span class="text-gray-700 font-bold">{{ paginator.count }}</span>건</p>
                <div class="flex items-center gap-1.5">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}&q={{ q|urlencode }}&status={{ status }}" class="w-9 h-9 flex items-center justify-center rounded-xl bg-white border border-gray-100 text-gray-400 hover:bg-gray-50 transition-all"><i class="fa-solid fa-angle-left"></i></a>
                    {% else %}
                    <span class="w-9 h-9 flex items-center justify-center rounded-xl bg-white border border-gray-100 text-gray-300"><i class="fa-solid fa-angle-left"></i></span>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if num == page_obj.number %}
                        <span class="w-9 h-9 flex items-center justify-center rounded-xl bg-yellow-400 text-white font-bold shadow-md shadow-yellow-400/20">{{ num }}</span>
                        {% elif num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                        <a href="?page={{ num }}&q={{ q|urlencode }}&status={{ status }}" class="w-9 h-9 flex items-center justify-center rounded-xl bg-white border border-gray-100 text-gray-600 hover:bg-gray-50 transition-all font-medium">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}&q={{ q|urlencode }}&status={{ status }}" class="w-9 h-9 flex items-center justify-center rounded-xl bg-white border border-gray-100 text-gray-400 hover:bg-gray-50 transition-all"><i class="fa-solid fa-angle-right"></i></a>
                    {% else %}
                    <span class="w-9 h-9 flex items-center justify-center rounded-xl bg-white border border-gray-100 text-gray-300"><i class="fa-solid fa-angle-right"></i></span>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t py-4 text-center text-[11px] text-gray-300 font-medium tracking-widest uppercase">
        Admin Management System &copy; 2026
    </footer>

</body>
</html>